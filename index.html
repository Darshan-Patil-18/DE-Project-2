<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sal College Lost & Found System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- EmailJS for real email OTP -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .highlight { background-color: #fef08a; padding: 2px 4px; border-radius: 2px; }
        .timer-warning { color: #ef4444; font-weight: bold; }
        .success-animation { animation: bounce 0.6s ease-in-out; }
        @keyframes bounce { 0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); } 40%, 43% { transform: translate3d(0,-30px,0); } 70% { transform: translate3d(0,-15px,0); } 90% { transform: translate3d(0,-4px,0); } }
        .loading { opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Navigation Bar (Hidden initially) -->
    <nav id="navbar" class="bg-white shadow-lg hidden">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-search text-2xl text-blue-600"></i>
                    <h1 class="text-xl font-bold text-gray-800">Sal College Lost & Found</h1>
                </div>
                <div class="flex items-center space-x-6">
                    <button onclick="showPage('home')" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-home mr-2"></i>Home
                    </button>
                    <button onclick="showPage('report-found')" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-plus-circle mr-2"></i>Report Found
                    </button>
                    <button onclick="showPage('report-lost')" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-exclamation-circle mr-2"></i>Report Lost
                    </button>
                    <button onclick="showPage('search')" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-search mr-2"></i>Search
                    </button>
                    <div class="relative">
                        <button onclick="toggleProfileMenu()" class="flex items-center text-gray-600 hover:text-blue-600 transition-colors">
                            <i class="fas fa-user-circle text-2xl"></i>
                            <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                        <div id="profileMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden z-50">
                            <button onclick="showPage('profile')" class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-user mr-2"></i>My Profile
                            </button>
                            <button onclick="logout()" class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <!-- Enrollment Verification Page -->
        <div id="enrollment-page" class="fade-in">
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-graduation-cap text-5xl text-blue-600 mb-4"></i>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">Sal College Lost & Found</h1>
                    <p class="text-gray-600">Enter your enrollment number to continue</p>
                </div>
                
                <form onsubmit="verifyEnrollment(event)">
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Enrollment Number</label>
                        <input type="text" id="enrollmentInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., SEC202401" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                        Verify Enrollment
                    </button>
                </form>
                
                <div class="mt-4 text-center">
                    <button type="button" onclick="showPage('login')" class="text-blue-600 hover:text-blue-800 text-sm cursor-pointer">
                        Already registered? Log in here
                    </button>
                </div>
                
                <div id="enrollmentError" class="mt-4 text-red-600 text-sm hidden"></div>
            </div>
        </div>

        <!-- Login Page -->
        <div id="login-page" class="fade-in hidden">
            <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-sign-in-alt text-5xl text-blue-600 mb-4"></i>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">Welcome Back</h1>
                    <p class="text-gray-600">Log in to your account</p>
                </div>
                
                <form onsubmit="loginUser(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Enrollment Number</label>
                        <input type="text" id="loginEnrollment" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Phone Number or Email</label>
                        <input type="text" id="loginContact" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Phone or Email used during registration" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                        Send Login OTP
                    </button>
                </form>
                
                <div class="mt-4 text-center">
                    <button type="button" onclick="showPage('enrollment')" class="text-blue-600 hover:text-blue-800 text-sm cursor-pointer">
                        Back to Enrollment Verification
                    </button>
                </div>
                
                <div id="loginError" class="mt-4 text-red-600 text-sm hidden"></div>
            </div>
        </div>

        <!-- Registration Page -->
        <div id="registration-page" class="fade-in hidden">
            <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-user-plus text-5xl text-blue-600 mb-4"></i>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">Complete Your Registration</h1>
                    <p class="text-gray-600">Fill in your details to create your account</p>
                </div>
                
                <form onsubmit="registerUser(event)">
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">College</label>
                            <select id="regCollege" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100" disabled>
                                <option value="">Select College</option>
                                <option value="Sal College of Engineering">Sal College of Engineering</option>
                                <option value="Sal Engineering and Technical Institute">Sal Engineering and Technical Institute</option>
                                <option value="Saliter">Saliter</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Enrollment Number</label>
                            <input type="text" id="regEnrollment" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100" readonly>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Full Name</label>
                        <input type="text" id="regName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <!-- Contact Verification Tabs -->
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Contact Verification</label>
                        <div class="flex border-b border-gray-200 mb-4">
                            <button type="button" onclick="switchContactTab('phone')" id="phoneTab" class="px-4 py-2 text-blue-600 border-b-2 border-blue-600 font-medium">
                                <i class="fas fa-phone mr-2"></i>Phone
                            </button>
                            <button type="button" onclick="switchContactTab('email')" id="emailTab" class="px-4 py-2 text-gray-500 hover:text-gray-700 font-medium">
                                <i class="fas fa-envelope mr-2"></i>Email
                            </button>
                        </div>
                        
                        <div id="phoneSection">
                            <div class="flex gap-2 mb-4">
                                <input type="tel" id="regPhone" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="+91 9876543210">
                                <button type="button" onclick="sendOTP('phone')" id="sendPhoneOTP" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors">
                                    Send OTP
                                </button>
                            </div>
                            <!-- reCAPTCHA container for phone -->
                            <div id="recaptcha-container-phone" class="mb-4"></div>
                        </div>
                        
                        <div id="emailSection" class="hidden">
                            <div class="flex gap-2 mb-4">
                                <input type="email" id="regEmail" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="student@example.com">
                                <button type="button" onclick="sendOTP('email')" id="sendEmailOTP" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors">
                                    Send OTP
                                </button>
                            </div>
                        </div>
                        
                        <div id="otpSection" class="hidden">
                            <div class="flex gap-2 mb-2">
                                <input type="text" id="otpInput" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter 6-digit OTP" maxlength="6">
                                <button type="button" onclick="verifyOTP()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                    Verify
                                </button>
                            </div>
                            <div id="otpTimer" class="text-sm text-gray-600"></div>
                        </div>
                        
                        <div id="verificationSuccess" class="hidden text-green-600 text-sm">
                            <i class="fas fa-check-circle mr-2"></i>Contact verified successfully!
                        </div>
                    </div>
                    
                    <button type="submit" id="registerBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400" disabled>
                        Complete Registration
                    </button>
                </form>
                
                <div id="registrationError" class="mt-4 text-red-600 text-sm hidden"></div>
            </div>
        </div>

        <!-- Home Dashboard -->
        <div id="home-page" class="fade-in hidden">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Welcome to Lost & Found</h1>
                <p class="text-gray-600">Help your fellow students find their lost items</p>
            </div>
            
            <!-- Statistics Cards -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                    <i class="fas fa-search text-3xl text-blue-600 mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-800" id="foundThisMonth">0</h3>
                    <p class="text-gray-600">Items Found This Month</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                    <i class="fas fa-handshake text-3xl text-green-600 mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-800" id="itemsReturned">0</h3>
                    <p class="text-gray-600">Items Returned</p>
                </div>
                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                    <i class="fas fa-exclamation-triangle text-3xl text-orange-600 mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-800" id="activeLostReports">0</h3>
                    <p class="text-gray-600">Active Lost Reports</p>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="grid md:grid-cols-3 gap-6">
                <button onclick="showPage('report-found')" class="bg-white rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition-shadow">
                    <i class="fas fa-plus-circle text-4xl text-green-600 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Report Found Item</h3>
                    <p class="text-gray-600">Found something? Help return it to its owner</p>
                </button>
                <button onclick="showPage('report-lost')" class="bg-white rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition-shadow">
                    <i class="fas fa-exclamation-circle text-4xl text-red-600 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Report Lost Item</h3>
                    <p class="text-gray-600">Lost something? Let others know to help you find it</p>
                </button>
                <button onclick="showPage('search')" class="bg-white rounded-lg shadow-lg p-6 text-center hover:shadow-xl transition-shadow">
                    <i class="fas fa-search text-4xl text-blue-600 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Search Database</h3>
                    <p class="text-gray-600">Search through found and lost items</p>
                </button>
            </div>
        </div>

        <!-- Report Found Item Page -->
        <div id="report-found-page" class="fade-in hidden">
            <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-plus-circle text-5xl text-green-600 mb-4"></i>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">Report Found Item</h1>
                    <p class="text-gray-600">Help return a found item to its owner</p>
                </div>
                
                <form onsubmit="submitFoundItem(event)">
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Category</label>
                            <select id="foundCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select Category</option>
                                <option value="Wallet">Wallet</option>
                                <option value="Keys">Keys</option>
                                <option value="ID Card">ID Card</option>
                                <option value="Books">Books</option>
                                <option value="Notes">Notes</option>
                                <option value="Earbuds/Headphones">Earbuds/Headphones</option>
                                <option value="Charger">Charger</option>
                                <option value="Water Bottle">Water Bottle</option>
                                <option value="Bag">Bag</option>
                                <option value="Laptop">Laptop</option>
                                <option value="Mobile Phone">Mobile Phone</option>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Date Found</label>
                            <input type="date" id="foundDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Item Name</label>
                        <input type="text" id="foundItemName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Black Leather Wallet" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Found Location</label>
                        <input type="text" id="foundLocation" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Library 2nd Floor" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Description</label>
                        <textarea id="foundDescription" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe the item in detail..."></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Upload Image (Optional)</label>
                        <input type="file" id="foundImage" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors">
                        Submit Found Item Report
                    </button>
                </form>
            </div>
        </div>

        <!-- Report Lost Item Page -->
        <div id="report-lost-page" class="fade-in hidden">
            <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-exclamation-circle text-5xl text-red-600 mb-4"></i>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">Report Lost Item</h1>
                    <p class="text-gray-600">Let others know about your lost item</p>
                </div>
                
                <form onsubmit="submitLostItem(event)">
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Category</label>
                            <select id="lostCategory" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select Category</option>
                                <option value="Wallet">Wallet</option>
                                <option value="Keys">Keys</option>
                                <option value="ID Card">ID Card</option>
                                <option value="Books">Books</option>
                                <option value="Notes">Notes</option>
                                <option value="Earbuds/Headphones">Earbuds/Headphones</option>
                                <option value="Charger">Charger</option>
                                <option value="Water Bottle">Water Bottle</option>
                                <option value="Bag">Bag</option>
                                <option value="Laptop">Laptop</option>
                                <option value="Mobile Phone">Mobile Phone</option>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Date Lost</label>
                            <input type="date" id="lostDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Item Name</label>
                        <input type="text" id="lostItemName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Black Leather Wallet" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Last Seen Location</label>
                        <input type="text" id="lostLocation" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Cafeteria" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Description</label>
                        <textarea id="lostDescription" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe the item in detail..."></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Upload Image (Optional)</label>
                        <input type="file" id="lostImage" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <button type="submit" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors">
                        Submit Lost Item Report
                    </button>
                </form>
            </div>
        </div>

        <!-- Search Page -->
        <div id="search-page" class="fade-in hidden">
            <div class="max-w-6xl mx-auto">
                <div class="text-center mb-8">
                    <i class="fas fa-search text-5xl text-blue-600 mb-4"></i>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">Search Database</h1>
                    <p class="text-gray-600">Find lost and found items</p>
                </div>
                
                <!-- Search Filters -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                    <div class="flex flex-wrap gap-4 mb-4">
                        <div class="flex border-b border-gray-200">
                            <button onclick="switchSearchTab('found')" id="searchFoundTab" class="px-4 py-2 text-green-600 border-b-2 border-green-600 font-medium">
                                <i class="fas fa-search mr-2"></i>Found Items
                            </button>
                            <button onclick="switchSearchTab('lost')" id="searchLostTab" class="px-4 py-2 text-gray-500 hover:text-gray-700 font-medium">
                                <i class="fas fa-exclamation-circle mr-2"></i>Lost Items
                            </button>
                        </div>
                        
                        <select id="searchCategory" onchange="performSearch()" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">All Categories</option>
                            <option value="Wallet">Wallet</option>
                            <option value="Keys">Keys</option>
                            <option value="ID Card">ID Card</option>
                            <option value="Books">Books</option>
                            <option value="Notes">Notes</option>
                            <option value="Earbuds/Headphones">Earbuds/Headphones</option>
                            <option value="Charger">Charger</option>
                            <option value="Water Bottle">Water Bottle</option>
                            <option value="Bag">Bag</option>
                            <option value="Laptop">Laptop</option>
                            <option value="Mobile Phone">Mobile Phone</option>
                            <option value="Others">Others</option>
                        </select>
                    </div>
                    
                    <input type="text" id="searchInput" oninput="performSearch()" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Search by item name, description, or location...">
                </div>
                
                <!-- Search Results -->
                <div id="searchResults" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Results will be populated here -->
                </div>
                
                <div id="noResults" class="text-center py-12 hidden">
                    <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-500 mb-2">No items found</h3>
                    <p class="text-gray-400">Try adjusting your search criteria</p>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profile-page" class="fade-in hidden">
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-8">
                    <i class="fas fa-user-circle text-5xl text-blue-600 mb-4"></i>
                    <h1 class="text-2xl font-bold text-gray-800 mb-2">My Profile</h1>
                    <p class="text-gray-600" id="profileInfo">Welcome back!</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- My Found Items -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-search text-green-600 mr-2"></i>
                            My Found Items
                        </h2>
                        <div id="myFoundItems" class="space-y-4">
                            <!-- Found items will be populated here -->
                        </div>
                    </div>
                    
                    <!-- My Lost Items -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
                            My Lost Items
                        </h2>
                        <div id="myLostItems" class="space-y-4">
                            <!-- Lost items will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-8 max-w-md mx-4 text-center success-animation">
            <i class="fas fa-check-circle text-6xl text-green-600 mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-800 mb-2" id="successTitle">Success!</h2>
            <p class="text-gray-600 mb-6" id="successMessage">Operation completed successfully.</p>
            <button onclick="closeSuccessModal()" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                Continue
            </button>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-8 max-w-md mx-4 text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">Sending OTP...</h2>
            <p class="text-gray-600">Please wait while we send your verification code</p>
        </div>
    </div>

    <script>
        // 🔥 FIREBASE CONFIGURATION - YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBwtwwoivOe0Q1THIjlMzSqJdT20kVIEJ0",
            authDomain: "sal-college-lost-found.firebaseapp.com",
            projectId: "sal-college-lost-found",
            storageBucket: "sal-college-lost-found.firebasestorage.app",
            messagingSenderId: "411864590304",
            appId: "1:411864590304:web:24a7a1f987c0801b8ced85"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let currentContactType = 'phone';
        let otpTimer = null;
        let otpTimeLeft = 0;
        let isOTPVerified = false;
        let currentSearchType = 'found';
        let confirmationResult = null;
        let recaptchaVerifier = null;

        // Valid enrollments database
        const validEnrollments = [
            { enrollment: '23113014011', college: 'Sal College of Engineering' },
            { enrollment: '231130146012', college: 'Sal College of Engineering' },
            { enrollment: '23113014013', college: 'Sal College of Engineering' },
            { enrollment: '24113014011', college: 'Sal Engineering and Technical Institute' },
            { enrollment: '24113014012', college: 'Sal Engineering and Technical Institute' },
            { enrollment: '24113014013', college: 'Sal Engineering and Technical Institute' },
            { enrollment: '25113014011', college: 'Saliter' },
            { enrollment: '25113014012', college: 'Saliter' },
            { enrollment: '25113014013', college: 'Saliter' },
            { enrollment: '25113014014', college: 'Saliter' }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App initialized');
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            const foundDateInput = document.getElementById('foundDate');
            const lostDateInput = document.getElementById('lostDate');
            
            if (foundDateInput) foundDateInput.value = today;
            if (lostDateInput) lostDateInput.value = today;
            
            // Check if user is already logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    loadUserData(user);
                }
            });
        });

        // Load user data from Firestore
        async function loadUserData(user) {
            try {
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    currentUser = { uid: user.uid, ...userDoc.data() };
                    showPage('home');
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Page navigation - FIXED VERSION
        function showPage(pageId) {
            console.log('Showing page:', pageId);
            
            // Hide all pages
            const pages = ['enrollment', 'login', 'registration', 'home', 'report-found', 'report-lost', 'search', 'profile'];
            pages.forEach(page => {
                const element = document.getElementById(page + '-page');
                if (element) {
                    element.classList.add('hidden');
                    element.classList.remove('fade-in');
                }
            });
            
            // Show selected page
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                setTimeout(() => {
                    targetPage.classList.add('fade-in');
                }, 10);
            } else {
                console.error('Page not found:', pageId + '-page');
            }
            
            // Show/hide navbar
            const navbar = document.getElementById('navbar');
            if (['home', 'report-found', 'report-lost', 'search', 'profile'].includes(pageId)) {
                navbar.classList.remove('hidden');
                if (pageId === 'home') updateDashboardStats();
                if (pageId === 'profile') loadProfileData();
                if (pageId === 'search') performSearch();
            } else {
                navbar.classList.add('hidden');
            }
            
            // Hide profile menu
            const profileMenu = document.getElementById('profileMenu');
            if (profileMenu) profileMenu.classList.add('hidden');
        }

        // Enrollment verification - FIXED VERSION
        function verifyEnrollment(event) {
            event.preventDefault();
            console.log('Verifying enrollment...');
            
            const enrollmentInput = document.getElementById('enrollmentInput');
            const errorDiv = document.getElementById('enrollmentError');
            
            if (!enrollmentInput || !errorDiv) {
                console.error('Required elements not found');
                return;
            }
            
            const enrollment = enrollmentInput.value.trim().toUpperCase();
            console.log('Checking enrollment:', enrollment);
            
            const validEnrollment = validEnrollments.find(e => e.enrollment === enrollment);
            
            if (validEnrollment) {
                console.log('Valid enrollment found:', validEnrollment);
                
                // Pre-fill registration form
                const regEnrollmentInput = document.getElementById('regEnrollment');
                const regCollegeSelect = document.getElementById('regCollege');
                
                if (regEnrollmentInput) regEnrollmentInput.value = enrollment;
                if (regCollegeSelect) regCollegeSelect.value = validEnrollment.college;
                
                showPage('registration');
                errorDiv.classList.add('hidden');
            } else {
                console.log('Invalid enrollment');
                errorDiv.textContent = 'Enrollment not found. Please check your number or contact administration.';
                errorDiv.classList.remove('hidden');
            }
        }

        // Contact tab switching
        function switchContactTab(type) {
            console.log('Switching to contact type:', type);
            currentContactType = type;
            
            // Update tab appearance
            const phoneTab = document.getElementById('phoneTab');
            const emailTab = document.getElementById('emailTab');
            
            if (phoneTab) {
                phoneTab.className = type === 'phone' 
                    ? 'px-4 py-2 text-blue-600 border-b-2 border-blue-600 font-medium'
                    : 'px-4 py-2 text-gray-500 hover:text-gray-700 font-medium';
            }
            
            if (emailTab) {
                emailTab.className = type === 'email'
                    ? 'px-4 py-2 text-blue-600 border-b-2 border-blue-600 font-medium'
                    : 'px-4 py-2 text-gray-500 hover:text-gray-700 font-medium';
            }
            
            // Show/hide sections
            const phoneSection = document.getElementById('phoneSection');
            const emailSection = document.getElementById('emailSection');
            
            if (phoneSection) phoneSection.classList.toggle('hidden', type !== 'phone');
            if (emailSection) emailSection.classList.toggle('hidden', type !== 'email');
            
            // Reset verification state
            resetOTPSection();
        }

        // Setup reCAPTCHA for phone verification (Disabled for speed)
        function setupRecaptcha() {
            // Disabled for demo - reCAPTCHA causes delays
            console.log('reCAPTCHA setup skipped for faster demo');
        }

        // Send REAL OTP via SMS/Email
        async function sendOTP(type) {
            console.log('Sending REAL OTP for type:', type);
            
            const contact = type === 'phone' 
                ? document.getElementById('regPhone').value.trim()
                : document.getElementById('regEmail').value.trim();
            
            if (!contact) {
                alert('Please enter your ' + type + ' number/address');
                return;
            }

            // Show loading
            const loadingModal = document.getElementById('loadingModal');
            if (loadingModal) loadingModal.classList.remove('hidden');
            
            try {
                // Generate random 6-digit OTP
                const generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
                window.currentOTP = generatedOTP; // Store for verification
                
                if (type === 'phone') {
                    // Send REAL SMS using Firebase Phone Auth
                    let phoneNumber = contact;
                    if (!phoneNumber.startsWith('+')) {
                        phoneNumber = '+91' + phoneNumber.replace(/\D/g, ''); // Clean and add +91
                    }
                    
                    // Setup reCAPTCHA for phone verification
                    if (!recaptchaVerifier) {
                        recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container-phone', {
                            'size': 'normal',
                            'callback': function(response) {
                                console.log('reCAPTCHA solved');
                            },
                            'expired-callback': function() {
                                console.log('reCAPTCHA expired');
                            }
                        });
                        recaptchaVerifier.render();
                    }
                    
                    // Send SMS via Firebase
                    confirmationResult = await auth.signInWithPhoneNumber(phoneNumber, recaptchaVerifier);
                    console.log('📱 REAL SMS OTP sent to:', phoneNumber);
                    alert('📱 Real SMS OTP sent to your phone number!');
                    
                } else {
                    // Send REAL EMAIL using EmailJS
                    const emailData = {
                        to_email: contact,
                        otp_code: generatedOTP,
                        user_name: document.getElementById('regName').value || 'Student',
                        service_id: 'service_sal_college',
                        template_id: 'template_otp_verification',
                        user_id: 'sal_college_public_key'
                    };
                    
                    // Send email via EmailJS API
                    const response = await fetch('https://api.emailjs.com/api/v1.0/email/send', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            service_id: 'service_sal_college',
                            template_id: 'template_otp_verification',
                            user_id: 'sal_college_public_key',
                            template_params: {
                                to_email: contact,
                                otp_code: generatedOTP,
                                user_name: emailData.user_name,
                                college_name: 'Sal College of Engineering'
                            }
                        })
                    });
                    
                    if (response.ok) {
                        console.log('📧 REAL EMAIL OTP sent to:', contact);
                        alert('📧 Real OTP sent to your email address!');
                    } else {
                        throw new Error('Failed to send email OTP');
                    }
                }
                
                // Show OTP section
                const otpSection = document.getElementById('otpSection');
                if (otpSection) otpSection.classList.remove('hidden');
                startOTPTimer();
                
                // Disable send button
                const sendBtn = type === 'phone' 
                    ? document.getElementById('sendPhoneOTP')
                    : document.getElementById('sendEmailOTP');
                if (sendBtn) {
                    sendBtn.disabled = true;
                    sendBtn.textContent = 'OTP Sent';
                    sendBtn.classList.add('bg-gray-400');
                    sendBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                }
                
            } catch (error) {
                console.error('Error sending REAL OTP:', error);
                alert('Error sending OTP: ' + error.message);
                
                // Re-enable send button on error
                const sendBtn = type === 'phone' 
                    ? document.getElementById('sendPhoneOTP')
                    : document.getElementById('sendEmailOTP');
                if (sendBtn) {
                    sendBtn.disabled = false;
                    sendBtn.textContent = 'Send OTP';
                    sendBtn.classList.remove('bg-gray-400');
                    sendBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                }
            } finally {
                if (loadingModal) loadingModal.classList.add('hidden');
            }
        }

        // Start OTP timer
        function startOTPTimer() {
            otpTimeLeft = 300; // 5 minutes
            const timerDiv = document.getElementById('otpTimer');
            
            if (!timerDiv) return;
            
            otpTimer = setInterval(() => {
                const minutes = Math.floor(otpTimeLeft / 60);
                const seconds = otpTimeLeft % 60;
                
                timerDiv.innerHTML = `<i class="fas fa-clock mr-1"></i>OTP expires in ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (otpTimeLeft <= 60) {
                    timerDiv.classList.add('timer-warning');
                }
                
                if (otpTimeLeft <= 0) {
                    clearInterval(otpTimer);
                    timerDiv.innerHTML = '<i class="fas fa-times-circle mr-1"></i>OTP expired. Please request a new one.';
                    confirmationResult = null;
                }
                
                otpTimeLeft--;
            }, 1000);
        }

        // Verify REAL OTP
        async function verifyOTP() {
            const otpInput = document.getElementById('otpInput');
            if (!otpInput) return;
            
            const enteredOTP = otpInput.value.trim();
            
            if (!enteredOTP || enteredOTP.length !== 6) {
                alert('Please enter a 6-digit OTP.');
                return;
            }
            
            try {
                let verificationSuccess = false;
                
                if (currentContactType === 'phone' && confirmationResult) {
                    // Verify SMS OTP via Firebase
                    try {
                        const result = await confirmationResult.confirm(enteredOTP);
                        console.log('✅ SMS OTP verified successfully!', result);
                        verificationSuccess = true;
                        
                        // Store the Firebase user for later use
                        window.firebaseUser = result.user;
                        
                    } catch (error) {
                        console.error('SMS OTP verification failed:', error);
                        alert('❌ Invalid SMS OTP. Please check and try again.');
                        otpInput.focus();
                        return;
                    }
                    
                } else if (currentContactType === 'email') {
                    // Verify Email OTP (compare with stored OTP)
                    if (enteredOTP === window.currentOTP) {
                        console.log('✅ Email OTP verified successfully!');
                        verificationSuccess = true;
                    } else {
                        alert('❌ Invalid Email OTP. Please check and try again.');
                        otpInput.focus();
                        return;
                    }
                }
                
                if (verificationSuccess) {
                    // OTP verified successfully
                    if (otpTimer) clearInterval(otpTimer);
                    
                    const otpSection = document.getElementById('otpSection');
                    const verificationSuccessDiv = document.getElementById('verificationSuccess');
                    const registerBtn = document.getElementById('registerBtn');
                    
                    if (otpSection) otpSection.classList.add('hidden');
                    if (verificationSuccessDiv) verificationSuccessDiv.classList.remove('hidden');
                    if (registerBtn) {
                        registerBtn.disabled = false;
                        registerBtn.classList.remove('bg-gray-400');
                        registerBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    }
                    
                    isOTPVerified = true;
                    
                    // Clear the stored OTP for security
                    window.currentOTP = null;
                    
                    alert('✅ Contact verified successfully! You can now complete registration.');
                }
                
            } catch (error) {
                console.error('Error verifying OTP:', error);
                alert('Error verifying OTP: ' + error.message);
            }
        }

        // Reset OTP section
        function resetOTPSection() {
            const otpSection = document.getElementById('otpSection');
            const verificationSuccess = document.getElementById('verificationSuccess');
            const registerBtn = document.getElementById('registerBtn');
            const otpInput = document.getElementById('otpInput');
            
            if (otpSection) otpSection.classList.add('hidden');
            if (verificationSuccess) verificationSuccess.classList.add('hidden');
            if (registerBtn) registerBtn.disabled = true;
            if (otpInput) {
                otpInput.value = '';
                otpInput.placeholder = 'Enter 6-digit OTP';
            }
            
            isOTPVerified = false;
            
            if (otpTimer) {
                clearInterval(otpTimer);
                otpTimer = null;
            }
            
            // Re-enable send buttons
            const sendPhoneOTP = document.getElementById('sendPhoneOTP');
            const sendEmailOTP = document.getElementById('sendEmailOTP');
            
            if (sendPhoneOTP) {
                sendPhoneOTP.disabled = false;
                sendPhoneOTP.textContent = 'Send OTP';
            }
            if (sendEmailOTP) {
                sendEmailOTP.disabled = false;
                sendEmailOTP.textContent = 'Send OTP';
            }
            
            // Clear reCAPTCHA
            if (recaptchaVerifier) {
                recaptchaVerifier.clear();
                recaptchaVerifier = null;
            }
        }

        // Register user (Simplified Fast Version)
        async function registerUser(event) {
            event.preventDefault();
            
            if (!isOTPVerified) {
                alert('Please verify your contact information first.');
                return;
            }
            
            try {
                const userData = {
                    enrollment: document.getElementById('regEnrollment').value,
                    college: document.getElementById('regCollege').value,
                    name: document.getElementById('regName').value.trim(),
                    contactType: currentContactType,
                    contact: currentContactType === 'phone' 
                        ? document.getElementById('regPhone').value.trim()
                        : document.getElementById('regEmail').value.trim(),
                    registeredAt: new Date().toISOString(),
                    uid: 'user_' + Date.now() // Generate simple UID for demo
                };
                
                // Store user data locally for demo (faster than Firestore)
                localStorage.setItem('currentUser', JSON.stringify(userData));
                currentUser = userData;
                
                console.log('✅ User registered successfully:', userData);
                
                showSuccessModal('Registration Complete!', 'Welcome to Sal College Lost & Found System. You can now report and search for items.');
                
            } catch (error) {
                console.error('Error registering user:', error);
                const registrationError = document.getElementById('registrationError');
                if (registrationError) {
                    registrationError.textContent = 'Registration failed: ' + error.message;
                    registrationError.classList.remove('hidden');
                }
            }
        }

        // Login user
        async function loginUser(event) {
            event.preventDefault();
            
            const loginEnrollment = document.getElementById('loginEnrollment');
            const loginContact = document.getElementById('loginContact');
            const errorDiv = document.getElementById('loginError');
            
            if (!loginEnrollment || !loginContact || !errorDiv) return;
            
            const enrollment = loginEnrollment.value.trim().toUpperCase();
            const contact = loginContact.value.trim();
            
            try {
                // Query Firestore for user with matching enrollment and contact
                const usersQuery = await db.collection('users')
                    .where('enrollment', '==', enrollment)
                    .where('contact', '==', contact)
                    .get();
                
                if (usersQuery.empty) {
                    errorDiv.textContent = 'Invalid enrollment number or contact information.';
                    errorDiv.classList.remove('hidden');
                    return;
                }
                
                const userDoc = usersQuery.docs[0];
                const userData = userDoc.data();
                
                // Send OTP based on contact type
                if (userData.contactType === 'phone') {
                    setupRecaptcha();
                    let phoneNumber = userData.contact;
                    if (!phoneNumber.startsWith('+')) {
                        phoneNumber = '+91' + phoneNumber;
                    }
                    
                    confirmationResult = await auth.signInWithPhoneNumber(phoneNumber, recaptchaVerifier);
                    
                } else {
                    // For email login, use Firebase Auth
                    const tempPassword = Math.random().toString(36).slice(-8);
                    await auth.sendPasswordResetEmail(userData.contact);
                    alert('Password reset email sent. Please check your email.');
                    return;
                }
                
                // Show OTP input for phone
                const otpInput = prompt('Enter the OTP sent to your phone:');
                if (otpInput && confirmationResult) {
                    await confirmationResult.confirm(otpInput);
                    currentUser = { uid: userDoc.id, ...userData };
                    showPage('home');
                    errorDiv.classList.add('hidden');
                }
                
            } catch (error) {
                console.error('Error during login:', error);
                errorDiv.textContent = 'Login failed: ' + error.message;
                errorDiv.classList.remove('hidden');
            }
        }

        // Submit found item (Save to Firestore)
        async function submitFoundItem(event) {
            event.preventDefault();
            
            try {
                const itemData = {
                    userId: currentUser.uid,
                    category: document.getElementById('foundCategory').value,
                    itemName: document.getElementById('foundItemName').value.trim(),
                    location: document.getElementById('foundLocation').value.trim(),
                    date: document.getElementById('foundDate').value,
                    description: document.getElementById('foundDescription').value.trim(),
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    isReturned: false,
                    type: 'found'
                };
                
                // Save to Firestore
                await db.collection('items').add(itemData);
                
                // Reset form
                document.getElementById('foundCategory').value = '';
                document.getElementById('foundItemName').value = '';
                document.getElementById('foundLocation').value = '';
                document.getElementById('foundDescription').value = '';
                const foundImage = document.getElementById('foundImage');
                if (foundImage) foundImage.value = '';
                
                showSuccessModal('Item Reported!', 'Your found item has been added to the database. Other students can now search for it.');
                
            } catch (error) {
                console.error('Error submitting found item:', error);
                alert('Error submitting item: ' + error.message);
            }
        }

        // Submit lost item (Save to Firestore)
        async function submitLostItem(event) {
            event.preventDefault();
            
            try {
                const itemData = {
                    userId: currentUser.uid,
                    category: document.getElementById('lostCategory').value,
                    itemName: document.getElementById('lostItemName').value.trim(),
                    location: document.getElementById('lostLocation').value.trim(),
                    date: document.getElementById('lostDate').value,
                    description: document.getElementById('lostDescription').value.trim(),
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    type: 'lost'
                };
                
                // Save to Firestore
                await db.collection('items').add(itemData);
                
                // Reset form
                document.getElementById('lostCategory').value = '';
                document.getElementById('lostItemName').value = '';
                document.getElementById('lostLocation').value = '';
                document.getElementById('lostDescription').value = '';
                const lostImage = document.getElementById('lostImage');
                if (lostImage) lostImage.value = '';
                
                showSuccessModal('Item Reported!', 'Your lost item has been added to the database. We\'ll help you find it!');
                
            } catch (error) {
                console.error('Error submitting lost item:', error);
                alert('Error submitting item: ' + error.message);
            }
        }

        // Search functionality (Query Firestore)
        function switchSearchTab(type) {
            currentSearchType = type;
            
            const searchFoundTab = document.getElementById('searchFoundTab');
            const searchLostTab = document.getElementById('searchLostTab');
            
            if (searchFoundTab) {
                searchFoundTab.className = type === 'found'
                    ? 'px-4 py-2 text-green-600 border-b-2 border-green-600 font-medium'
                    : 'px-4 py-2 text-gray-500 hover:text-gray-700 font-medium';
            }
            
            if (searchLostTab) {
                searchLostTab.className = type === 'lost'
                    ? 'px-4 py-2 text-red-600 border-b-2 border-red-600 font-medium'
                    : 'px-4 py-2 text-gray-500 hover:text-gray-700 font-medium';
            }
            
            performSearch();
        }

        async function performSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchCategory = document.getElementById('searchCategory');
            
            if (!searchInput || !searchCategory) return;
            
            const searchTerm = searchInput.value.toLowerCase();
            const category = searchCategory.value;
            
            try {
                let query = db.collection('items').where('type', '==', currentSearchType);
                
                if (currentSearchType === 'found') {
                    query = query.where('isReturned', '==', false);
                }
                
                if (category) {
                    query = query.where('category', '==', category);
                }
                
                const snapshot = await query.get();
                let items = [];
                
                snapshot.forEach(doc => {
                    items.push({ id: doc.id, ...doc.data() });
                });
                
                // Filter by search term (client-side filtering for text search)
                if (searchTerm) {
                    items = items.filter(item => 
                        item.itemName.toLowerCase().includes(searchTerm) ||
                        (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                        item.location.toLowerCase().includes(searchTerm)
                    );
                }
                
                displaySearchResults(items, searchTerm);
                
            } catch (error) {
                console.error('Error searching items:', error);
            }
        }

        function displaySearchResults(items, searchTerm) {
            const resultsContainer = document.getElementById('searchResults');
            const noResultsDiv = document.getElementById('noResults');
            
            if (!resultsContainer || !noResultsDiv) return;
            
            if (items.length === 0) {
                resultsContainer.innerHTML = '';
                noResultsDiv.classList.remove('hidden');
                return;
            }
            
            noResultsDiv.classList.add('hidden');
            
            resultsContainer.innerHTML = items.map(item => {
                // Highlight search terms
                const highlightText = (text) => {
                    if (!searchTerm || !text) return text;
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    return text.replace(regex, '<span class="highlight">$1</span>');
                };
                
                const cardColor = currentSearchType === 'found' ? 'border-green-500' : 'border-red-500';
                const iconColor = currentSearchType === 'found' ? 'text-green-600' : 'text-red-600';
                const icon = currentSearchType === 'found' ? 'fa-search' : 'fa-exclamation-circle';
                
                return `
                    <div class="bg-white rounded-lg shadow-lg border-l-4 ${cardColor} p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center">
                                <i class="fas ${icon} ${iconColor} text-xl mr-3"></i>
                                <div>
                                    <h3 class="font-bold text-gray-800">${highlightText(item.itemName)}</h3>
                                    <span class="text-sm text-gray-500">${item.category}</span>
                                </div>
                            </div>
                            <span class="text-xs text-gray-400">${new Date(item.date).toLocaleDateString()}</span>
                        </div>
                        
                        <div class="space-y-2 text-sm">
                            <p><strong>Location:</strong> ${highlightText(item.location)}</p>
                            ${item.description ? `<p><strong>Description:</strong> ${highlightText(item.description)}</p>` : ''}
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <p class="text-xs text-gray-500">
                                ${currentSearchType === 'found' ? 'Found' : 'Lost'} on ${new Date(item.date).toLocaleDateString()}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Profile management (Load from Firestore)
        async function loadProfileData() {
            if (!currentUser) return;
            
            const profileInfo = document.getElementById('profileInfo');
            if (profileInfo) {
                profileInfo.textContent = 
                    `${currentUser.name} • ${currentUser.enrollment} • ${currentUser.college}`;
            }
            
            try {
                // Load user's items
                const itemsSnapshot = await db.collection('items')
                    .where('userId', '==', currentUser.uid)
                    .get();
                
                const foundItems = [];
                const lostItems = [];
                
                itemsSnapshot.forEach(doc => {
                    const item = { id: doc.id, ...doc.data() };
                    if (item.type === 'found') {
                        foundItems.push(item);
                    } else {
                        lostItems.push(item);
                    }
                });
                
                // Display found items
                const myFoundItemsContainer = document.getElementById('myFoundItems');
                if (myFoundItemsContainer) {
                    if (foundItems.length === 0) {
                        myFoundItemsContainer.innerHTML = '<p class="text-gray-500 text-center py-4">No found items reported yet.</p>';
                    } else {
                        myFoundItemsContainer.innerHTML = foundItems.map(item => `
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">${item.itemName}</h4>
                                    <span class="text-xs text-gray-500">${new Date(item.date).toLocaleDateString()}</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${item.category} • ${item.location}</p>
                                ${item.description ? `<p class="text-sm text-gray-500 mb-3">${item.description}</p>` : ''}
                                
                                ${!item.isReturned ? `
                                    <button onclick="markAsReturned('${item.id}')" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors">
                                        Mark as Returned
                                    </button>
                                ` : `
                                    <span class="text-green-600 text-sm font-medium">
                                        <i class="fas fa-check-circle mr-1"></i>Returned
                                    </span>
                                `}
                            </div>
                        `).join('');
                    }
                }
                
                // Display lost items
                const myLostItemsContainer = document.getElementById('myLostItems');
                if (myLostItemsContainer) {
                    if (lostItems.length === 0) {
                        myLostItemsContainer.innerHTML = '<p class="text-gray-500 text-center py-4">No lost items reported yet.</p>';
                    } else {
                        myLostItemsContainer.innerHTML = lostItems.map(item => `
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">${item.itemName}</h4>
                                    <span class="text-xs text-gray-500">${new Date(item.date).toLocaleDateString()}</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${item.category} • ${item.location}</p>
                                ${item.description ? `<p class="text-sm text-gray-500">${item.description}</p>` : ''}
                            </div>
                        `).join('');
                    }
                }
                
            } catch (error) {
                console.error('Error loading profile data:', error);
            }
        }

        // Mark item as returned (Update Firestore)
        async function markAsReturned(itemId) {
            try {
                await db.collection('items').doc(itemId).update({
                    isReturned: true,
                    returnedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showSuccessModal('Woahhh! 🎉', 'You did a great job helping a fellow student!');
                loadProfileData(); // Refresh profile data
                
            } catch (error) {
                console.error('Error marking item as returned:', error);
                alert('Error updating item: ' + error.message);
            }
        }

        // Update dashboard statistics (Query Firestore)
        async function updateDashboardStats() {
            try {
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                // Get all items
                const itemsSnapshot = await db.collection('items').get();
                
                let foundThisMonth = 0;
                let itemsReturned = 0;
                let activeLostReports = 0;
                
                itemsSnapshot.forEach(doc => {
                    const item = doc.data();
                    
                    if (item.type === 'found') {
                        const itemDate = new Date(item.date);
                        if (itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear) {
                            foundThisMonth++;
                        }
                        if (item.isReturned) {
                            itemsReturned++;
                        }
                    } else if (item.type === 'lost') {
                        activeLostReports++;
                    }
                });
                
                const foundThisMonthEl = document.getElementById('foundThisMonth');
                const itemsReturnedEl = document.getElementById('itemsReturned');
                const activeLostReportsEl = document.getElementById('activeLostReports');
                
                if (foundThisMonthEl) foundThisMonthEl.textContent = foundThisMonth;
                if (itemsReturnedEl) itemsReturnedEl.textContent = itemsReturned;
                if (activeLostReportsEl) activeLostReportsEl.textContent = activeLostReports;
                
            } catch (error) {
                console.error('Error updating dashboard stats:', error);
            }
        }

        // Profile menu toggle
        function toggleProfileMenu() {
            const menu = document.getElementById('profileMenu');
            if (menu) menu.classList.toggle('hidden');
        }

        // Logout
        async function logout() {
            try {
                await auth.signOut();
                currentUser = null;
                showPage('enrollment');
            } catch (error) {
                console.error('Error signing out:', error);
            }
        }

        // Success modal
        function showSuccessModal(title, message) {
            const successTitle = document.getElementById('successTitle');
            const successMessage = document.getElementById('successMessage');
            const successModal = document.getElementById('successModal');
            
            if (successTitle) successTitle.textContent = title;
            if (successMessage) successMessage.textContent = message;
            if (successModal) successModal.classList.remove('hidden');
        }

        function closeSuccessModal() {
            const successModal = document.getElementById('successModal');
            if (successModal) successModal.classList.add('hidden');
            showPage('home');
        }

        // Close profile menu when clicking outside
        document.addEventListener('click', function(event) {
            const profileMenu = document.getElementById('profileMenu');
            const profileButton = event.target.closest('button');
            
            if (!profileButton || !profileButton.onclick || profileButton.onclick.toString().indexOf('toggleProfileMenu') === -1) {
                if (profileMenu) profileMenu.classList.add('hidden');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9737db04230e0333',t:'MTc1NTkyMzIyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

